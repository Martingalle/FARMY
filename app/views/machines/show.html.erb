<%= render 'shared/navproduct' %>
<div class="container">
  <div class="row" style="margin-top: 100px;">
    <div id="pics" class="product">
      <div class="col-xs-12 col-md-8" style="margin-bottom: 50px;">
        <div class="img">
          <%= cl_image_tag @machine.photo, width: 600, crop: 'scale' %>
        </div>
        <h2>Make: <%= @machine.make %></h2>
        <h2>Category: <%= @machine.category %></h2>
        <div id="desc" style="padding-top:30px">
          <h2>Description</h2>
          <p style="margin:0px">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ullam explicabo magni nam tenetur sapiente similique voluptatem nobis nisi laboriosam. Perferendis vero, totam doloremque omnis ut blanditiis mollitia obcaecati ab esse.</p>
          <p style="margin:0px">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ullam nam, quidem alias iusto pariatur eius inventore, quae ipsa, placeat labore optio sit incidunt magni quod, fugit quas. Aliquam, similique saepe?</p>
        </div>
        <div id="mapp" style="padding-top:30px"></div>
        <h2>Location</h2>
        <div
            id="map"
            style="width: 100%;
            height: 600px;"
            data-markers="<%= @markers.to_json %>"
          ></div>
        </div>
      </div>
      <div class="col-xs-12 col-md-4">
        <div class="tophead" style="margin-bottom: 154px;">
          <div class="price">$<%= @machine.price_per_hour %>/hour</div>
          <div class="days">3 jours minimum</div>
        </div>
        <!-- test calendar -->

        <div id="icon_calendar">

            <div id="month_wrap">
              <img id="fleche_mois1" class="fleches_mois" src="http://img11.hostingpics.net/pics/163358chevrongauche.png" height="20" width="13" value="-1">
              <img id="fleche_mois2" class="fleches_mois" src="http://img11.hostingpics.net/pics/941588chevrondroite.png" height="20" width="13" value="1">
              <div id="month{{$index+1}}" class="mois" ng-repeat="m in mois">
                {{m.name}}
              </div>
            </div>

            <div id="days_wrap">
              <span id="day{{$index+1}}" class="days" ng-repeat="d in jours">{{d.day}}
              </span>
            </div>


          </div>

        <!-- calendar -->
        <div class="rent-div" style="display: flex; justify-content: center;">
          <a href="#" class="btn btn-primary btn-product" style="margin-top: 0px!important;">Rent me</a>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.4/angular.min.js"></script>
<script src="//code.jquery.com/jquery-2.1.3.min.js"></script>
<script>


  var victorApp=angular.module('myapp',[])



  victorApp.controller('main', ['$scope', function ($scope) {

    $("html").click(function(){
      if ($("#icon_calendar").width()!=80) {
        ok=0
        $("#icon_calendar").css({width:80,height:80,borderRadius:"18px",marginLeft:-40,marginTop:-40,animation:"bounce2 0.3s",cursor:"pointer",transform:"scale(1)"})
        $(".mois").css({display:"none",fontSize:14,width:80})
        $(".days").css({fontFamily:"'openlight',sans-serif",display:"none",backgroundColor:"transparent",color:"#3C3C3C"})
        $("#month_wrap").css({backgroundColor:"transparent",color:"#F05252"})
        $("#month"+mois_choisi).css({marginLeft:0,display:"block"})
        $("#day"+jour_choisi).css({position:"absolute",fontSize:30,width:"100%",display:"block"})
        $(".fleches_mois").hide()
        console.log("eee")
      };
    })

    $("body").on('click',"#icon_calendar",function(event){
      event.stopPropagation();
      if ($(this).width()==80) {
        ok=1
        $(this).css({width:160,height:150,borderRadius:"7px",marginLeft:-80,marginTop:-75,animation:"bounce 0.3s",cursor:"initial",transform:"scale(1)"})
        $(".mois").css({display:"block",fontSize:18,width:100})
        $(".days").css({fontFamily:"'openbold',sans-serif",display:"block"})
        $("#month_wrap").css({backgroundColor:"#F05252",color:"rgb(240,240,240)"})
        $("#month"+mois_choisi).css("margin-left",30)

  if (mois_choisi==ladate.getMonth())
  {
   $("#day"+ladate.getDate()).css({position:"relative",fontSize:12,width:"calc(100%/7)",backgroundColor:"#2295EC",color:"rgb(240,240,240)"})
  }
        $("#day"+jour_choisi).css({position:"relative",fontSize:12,width:"calc(100%/7)"})
        mois_retenu=mois_choisi
        console.log("lol")
        $(".fleches_mois").show()

      };

    })

    $("body").on("click",".days",function(event){
      event.stopPropagation();
      if ($("#icon_calendar").width()!=80) {
        ok=0
        $("#icon_calendar").css({width:80,height:80,borderRadius:"18px",marginLeft:-40,marginTop:-40,animation:"bounce2 0.3s",cursor:"pointer",transform:"scale(1)"})
        $(".mois").css({display:"none",fontSize:14,width:80})
        $(".days").css({fontFamily:"'openlight',sans-serif",display:"none",backgroundColor:"transparent",color:"#3C3C3C"})
        $("#month_wrap").css({backgroundColor:"transparent",color:"#F05252"})
        $("#month"+mois_choisi).css({marginLeft:0,display:"block"})
        jour_choisi=$(this).html()
        console.log($(this).html())
        $("body").trigger("mouseleave",".days")
        $("#day"+jour_choisi).css({position:"absolute",fontSize:30,width:"100%",display:"block"})
        $(".fleches_mois").hide()
      }
      else
      {
        ok=1
        $("#icon_calendar").css({width:160,height:150,borderRadius:"7px",marginLeft:-80,marginTop:-75,animation:"bounce 0.3s",cursor:"initial",transform:"scale(1)"})
        $(".mois").css({display:"block",fontSize:18,width:100})
        $(".days").css({fontFamily:"'openbold',sans-serif",display:"block"})
        $("#month_wrap").css({backgroundColor:"#F05252",color:"rgb(240,240,240)"})
        $("#month"+mois_choisi).css("margin-left",30)
        $("#day"+ladate.getDate()).css({position:"relative",fontSize:12,width:"calc(100%/7)",backgroundColor:"#2295EC",color:"rgb(240,240,240)"})
        $("#day"+jour_choisi).css({position:"relative",fontSize:12,width:"calc(100%/7)"})
        mois_retenu=mois_choisi
        $(".fleches_mois").show()
      }

    })

    $("body").on("mouseenter",".days",function(e){
      if ($("#icon_calendar").width()!=80) {
        $(this).css("font-size",20)
      };
    })
    $("body").on("mouseleave",".days",function(e){
      if (ok==1) {
        $(this).css("font-size",12)
      };
    })

    $("#icon_calendar").mouseenter(function(){
      if ($(this).width()==80) {
        $(this).css("transform","scale(1.1)")
      }
    })

    $("#icon_calendar").mouseleave(function(){
      if ($(this).width()==80) {
        $(this).css("transform","scale(1)")
      }
    })


    $(".fleches_mois").click(function() {
      var direct=eval($(this).attr("value"))
      var ladate=new Date()
      if (direct==-1 && mois_choisi>1)
      {
        $("#month"+(mois_choisi+1)).css({marginLeft:230,opacity:0.15,textAlign:"left"})
        $("#month"+(mois_choisi)).css({marginLeft:130,opacity:0.15,textAlign:"left"})
        $("#month"+(mois_choisi-1)).css({marginLeft:30,opacity:1,textAlign:"center"})
        $("#month"+(mois_choisi-2)).css({marginLeft:-70,opacity:0.15,textAlign:"right"})
        mois_choisi--
        $scope.jours=[]
        for (var i = 1; i <=$scope.mois[mois_choisi-1]['days']; i++) {$scope.jours.push({day:i})}
        $scope.$apply()
        $(".days").css({fontFamily:"'openbold',sans-serif",display:"block"})
        if (mois_choisi==ladate.getMonth()+1) {
          $("#day"+ladate.getDate()).css({backgroundColor:"#2295EC",color:"rgb(240,240,240)"})
        };
        if (mois_choisi==1) {$("#fleche_mois1").hide()}
        else{$(".fleches_mois").show()}
      }

      else if (direct==1 && mois_choisi<12)
      {
        $("#month"+(mois_choisi-1)).css({marginLeft:-170,opacity:0.15,textAlign:"right"})
        $("#month"+(mois_choisi)).css({marginLeft:-70,opacity:0.15,textAlign:"right"})
        $("#month"+(mois_choisi+1)).css({marginLeft:30,opacity:1,textAlign:"center"})
        $("#month"+(mois_choisi+2)).css({marginLeft:130,opacity:0.15,textAlign:"left"})
        mois_choisi++
        $scope.jours=[]
        for (var i = 1; i <=$scope.mois[mois_choisi-1]['days']; i++) {
          $scope.jours.push({day:i})
        }
        $scope.$apply()
        if (mois_choisi==ladate.getMonth()+1) {
          $("#day"+ladate.getDate()).css({backgroundColor:"#2295EC",color:"rgb(240,240,240)"})
        }
        $(".days").css({fontFamily:"'openbold',sans-serif",display:"block"})
        if (mois_choisi==12) {$("#fleche_mois2").hide()}
        else{$(".fleches_mois").show()}
      }
      return false
    })

    var ladate= new Date()
    var mois_choisi=ladate.getMonth()+1
    var jour_choisi=ladate.getDate()

    $scope.mois=[
    {name:"January",days:31},
    {name:"Febrary",days:28},
    {name:"March",days:31},
    {name:"April",days:30},
    {name:"May",days:31},
    {name:"June",days:30},
    {name:"July",days:31},
    {name:"August",days:31},
    {name:"September",days:30},
    {name:"October",days:31},
    {name:"November",days:30},
    {name:"December",days:31}]
    var ok=0
    $scope.jours=[]
    for (var i = 1; i <=$scope.mois[mois_choisi-1]['days']; i++) {
      $scope.jours.push({day:i})
    }

    setTimeout(function(){
      for (var i = 1; i <=12; i++) {
        var j=mois_choisi-i
        if (j==0) {$("#month"+i).css({marginLeft:0,opacity:1,textAlign:"center",display:"block"})}
        else if (j==1) {$("#month"+i).css({marginLeft:-70,opacity:0.15,textAlign:"right"})}
        else if (j>0) {$("#month"+i).css({marginLeft:-170,opacity:0.15,textAlign:"right"})}
        else if (j==-1) {$("#month"+i).css({marginLeft:130,opacity:0.15,textAlign:"left "})}
        else if (j<0) {$("#month"+i).css({marginLeft:230,opacity:0.15,textAlign:"left "})}
      }
    })

    $scope.$apply()

    setTimeout(function(){
      $("#day"+jour_choisi).css({
        position:"absolute",
        fontSize:30,
        width:"100%",
        display:"block"
      })
    },10)


  }]);


</script>
